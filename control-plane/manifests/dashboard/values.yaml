kubernetes-dashboard:
  protocolHttp: false
  app:  
    ingress:
      enabled: true
      issuer: 
        name: letsencrypt-staging
        scope: cluster
      tls:
        enabled: true
      hosts:
        - dashboard.tineochristopher.com
      path: /
      pathType: Prefix
      ingressClassName: nginx
      pathType: Prefix
      annotations:
        nginx.ingress.kubernetes.io/backend-protocol: "HTTPS"
        nginx.ingress.kubernetes.io/ssl-redirect: "true"

        # External DNS
        external-dns.alpha.kubernetes.io/hostname: dashboard.tineochristopher.com
        external-dns.alpha.kubernetes.io/target: 96.248.109.98

        # oauth2-proxy annotations
        nginx.ingress.kubernetes.io/auth-response-headers: Authorization
        nginx.ingress.kubernetes.io/auth-signin: https://$host/oauth2/start?rd=$escaped_request_uri
        nginx.ingress.kubernetes.io/auth-url: https://$host/oauth2/auth
oauth2-proxy:
  config:
    existingSecret: dashboard-oauth2-proxy
    configFile: |
      provider = "oidc"
      oidc_issuer_url = "https://keycloak.tineochristopher.com/realms/kubernetes"
      email_domains = [ "*" ]
      cookie_secure = true
      upstreams = [ "https://dashboard-kong-proxy.kubernetes-dashboard.svc.cluster.local:443" ]
      redirect_url = "https://dashboard.tineochristopher.com/oauth2/callback"
      scope = "openid email profile"
      pass_access_token = true
      pass_authorization_header = true
      pass_user_headers = true
      set_authorization_header = true
      cookie_domains = ".tineochristopher.com"
      cookie_name = "_oauth2_proxy"
      cookie_refresh = "2m"
      cookie_expire = "24h"
      code_challenge_method = "S256"
      reverse_proxy = true
  ingress:
    enabled: true
    className: nginx
    path: /oauth2
    pathType: Prefix
    annotations:
      cert-manager.io/cluster-issuer: "letsencrypt-staging"
      nginx.ingress.kubernetes.io/ssl-redirect: "true"
      nginx.ingress.kubernetes.io/backend-protocol: "HTTP"
    tls:
      - hosts:
        - dashboard.tineochristopher.com
        secretName: dashboard-kubernetes-dashboard-certs
    hosts:
      - dashboard.tineochristopher.com